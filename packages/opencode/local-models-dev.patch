From 243bc660ba9082ed93869a83e0f1b9be6e62b844 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?J=C3=B6rg=20Thalheim?= <joerg@thalheim.io>
Date: Thu, 6 Nov 2025 08:18:15 +0100
Subject: [PATCH] Use local MODELS_DEV_API_JSON if available
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: JÃ¶rg Thalheim <joerg@thalheim.io>
---
 packages/opencode/src/provider/models-macro.ts | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/packages/opencode/src/provider/models-macro.ts b/packages/opencode/src/provider/models-macro.ts
index 91a0348..081eb0d 100644
--- a/packages/opencode/src/provider/models-macro.ts
+++ b/packages/opencode/src/provider/models-macro.ts
@@ -1,4 +1,15 @@
 export async function data() {
+  const localApiJsonPath = process.env.MODELS_DEV_API_JSON
+
+  // Try to read from local file if path is provided
+  if (localApiJsonPath) {
+    const localFile = Bun.file(localApiJsonPath)
+    if (await localFile.exists()) {
+      return await localFile.text()
+    }
+  }
+
+  // Fallback to fetching from remote URL
   const json = await fetch("https://models.dev/api.json").then((x) => x.text())
   return json
 }
-- 
2.51.0

